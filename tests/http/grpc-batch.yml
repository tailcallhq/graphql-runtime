config: !file tests/http/config/grpc-batch.graphql
name: Grpc datasource with batching
mock:
  - request:
      url: http://localhost:50051/NewsService/GetMultipleNews
      method: POST
      body: \0\0\0\0\n\n\x03\n\x012\n\x03\n\x013
    response:
      body: \0\0\0\0L\n$\n\x012\x12\x06Note 2\x1a\tContent 2\"\x0cPost image 2\n$\n\x013\x12\x06Note 3\x1a\tContent 3\"\x0cPost image 3
  - request:
      url: http://localhost:50051/NewsService/GetMultipleNews
      method: POST
      body: \0\0\0\0\n\n\x03\n\x013\n\x03\n\x012
    response:
      body: \0\0\0\0L\n$\n\x013\x12\x06Note 3\x1a\tContent 3\"\x0cPost image 3\n$\n\x013\x12\x06Note 3\x1a\tContent 3\"\x0cPost image 3
assert:
  - request:
      method: POST
      url: http://localhost:8080/graphql
      body:
        query: 'query { newsById2: newsById(news: {id: "2"}) { title }, newsById3: newsById(news: {id: "3"}) { title } }'
    response:
      body:
        data:
          newsById2:
            title: Note 2
          newsById3:
            title: Note 3
